name: Update Jio Playlist

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # --------------------------------------------
      # STEP 1: CHECKOUT REPOSITORY
      # --------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # --------------------------------------------
      # STEP 2: ENSURE SOURCES FOLDER
      # --------------------------------------------
      - name: Prepare sources folder
        run: |
          mkdir -p sources

      # --------------------------------------------
      # STEP 3: DOWNLOAD JIO SOURCE (TEMP)
      # --------------------------------------------
      - name: Download Jio playlist
        env:
          SRC_JTV: ${{ secrets.SRC_JTV }}
        run: |
          wget -q -O sources/jai_raw.m3u "$SRC_JTV"

      # --------------------------------------------
      # STEP 4: REMOVE UNWANTED CHANNELS (STRICT)
      # --------------------------------------------
      - name: Clean unwanted channels (jai.vxn only)
        run: |
          awk '
            BEGIN { IGNORECASE=1; keep=0 }

            # Block channels containing these words
            function is_blocked(line) {
              return (line ~ /tamil|telugu|kannada|bangla|malayalam|english|test|wow|swayam|sathee|ap-|vidya|gujarat|bengali|asianet|maa|ptc|vijay|etv|aath|rongeen|raj|punjab|manorama|mahaa|jaya|gemini|udaya|salaam|surya|adithya|amrita|colors super$|arunprabha|girnar|kashir|oriya|saptagiri|urdu|podhigai|desi|kairali|jalsha|studio|apex|flower|jonack|kalaignar|makkal|may|mk|moon|nakshatra|bangalore|peppers|polimer|puthu|sanjha|sidharth|spondon|kiran|sun tv|sundrani|suvarna|thanthi|vaanavil|vasanth|vendhar|vissa|jomjomat|j movies|ktv|maha|mahua|pitaara|public m|sun life|tabbar|thalaa|e 24$|chintu|chutti|kochu|kushi|naap|east|sun music|sun news|nick junior|sonic marathi$|rang|sristi|teh|4 tv|6 tv|10 tv|99 tv|ananda|asmita|ganga|abc|abn|chanakya|harya|mp|ghanta|kalak|jhar|nepal|taiwan|karn|kera|bihar|mh/)
            }

            /^#EXTINF/ {
              if (is_blocked($0)) {
                keep=0
              } else {
                keep=1
                print
              }
              next
            }

            {
              if (keep==1) print
            }
          ' sources/jai_raw.m3u > sources/jai.vxn

          rm -f sources/jai_raw.m3u

      # --------------------------------------------
      # STEP 5: COMMIT & PUSH
      # --------------------------------------------
      - name: Commit and push changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add sources/jai.vxn
          git commit -m "Update Jio playlist (jai.vxn)" || echo "No changes"
          git push

